<!-- Author: Ruth Ondrada -->

<!DOCTYPE html>
<html>
  <head>
    <title>BandLab's Audio Library </title>
  </head>

  <body>
    <h1>Hello,</h1>
    <p>
      Welcome to <strong> BandLab's</strong> audio library! We have a few sets of audio for you to checkout!<br><br>
      Please make your audio choices from the drop down audioList.<br>
    </p>

    <!--Provide an audio list to users-->
    <select id="audioList" onchange="selectAudio()">
     <option selected ="selected" value="0">Please select an audio</option>
     <option value="1">Synth Organ</option>
     <option value="2">New Wave Kit</option>
   </select>

    <button id="play" >Play!</button>

  <!-- script starts here, will use web audio API -->
  <script>

  //Global declaration of users option
  var userOption;

  //When the Play button has been clicked in the UI, the audio button will this function
  //this function, will obtain users option on which audio to play, create audio context, load , buffer, decode, and play
  function selectAudio(){
    //console.log("Here");

    //obtain the value of the drop down list
    var listValue = document.getElementById("audioList");
    userOption = listValue.options[listValue.selectedIndex].value;
    console.log("selection: ", userOption);

    var audioBuffer = null;

    console.log("selection AGAIN: ", userOption);

    //afer which, get the users option and put in a variable called audioURL, this is what the url to paly the audioURL/
    //we use https://cors-anywhere.herokuapp.com to by pass the browser CORS issue
    if(userOption == "1"){
      console.log("THIS IS 1 SELECTED: ", userOption);
      var audioURL = 'https://cors-anywhere.herokuapp.com/https://static.bandlab.com/soundbanks/previews/synth-organ.ogg';
    }
    else if(userOption =="2"){
      console.log("Selected: ", userOption);
      var audioURL = 'https://cors-anywhere.herokuapp.com/https://static.bandlab.com/soundbanks/previews/new-wave-kit.ogg';
    }
    //if selected other value aside then it will alert the user to choose an audio
    else {
      alert("Please select audio");
    }

    const URL = audioURL;
    var context = new AudioContext();
    const playButton = document.querySelector('#play');


      //to load the audio
      console.log("url : ", URL);
      var request = new XMLHttpRequest();
      request.open('GET', URL, true);
      request.responseType = 'arraybuffer';

      // Decode asynchronously
      request.onload = function() {
      console.log("onLoad");
        context.decodeAudioData(request.response, function(buffer) {

          console.log("req : ", request.response);
          audioBuffer = buffer;
        });

        playButton.onclick = () => playSound(audioBuffer);
        function playSound(buffer) {
        playButton.disabled = true;
        console.log("PlaySound");
        var source = context.createBufferSource(); // creates a sound source
        source.buffer = buffer;                    // tell the source which sound to play
        source.connect(context.destination);       // connect the source to the context's destination (the speakers)
        source.start();                           // play the source now
        }
      }
      request.send();
    //} // end of loadAudio

  } //end of selectAudio function

  </script>
</body>
</html>

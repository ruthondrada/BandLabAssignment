<!-- Task:
      Create a web application that has  2 pages.
      page 1
        (1) User can request the list of posts form Jsonplaceholder API and see the results collated together
        (2) User can alphabetically sort the posts based on their title
        (3) The user can group the posts by user ID
-->
<!DOCTYPE html>
<html>
  <head>
      <title>BandLab Home</title>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>

  </head>

  <body>
    <h1> Hello!</h1>
    Click on the button below to request for list of posts
    <input type="submit" value="Request list of posts" id="fetchDataFromAPI"/>
    <input type="submit" value="Sort by Title A-Z" id="sortTitle" hidden="hidden"/>
    <input type="submit" value="Group by" id="groupBy" hidden="hidden"/>


    <p id="showData"></p>


    <!-- Put script below so that the page will load first.-->
    <script>
      // create a javascript eventListener to handle click event in the index.html
      document.getElementById('fetchDataFromAPI').addEventListener('click', fetchDataFromAPI);
      document.getElementById('sortTitle').addEventListener('click', sortTitle);
      document.getElementById('groupBy').addEventListener('click', groupBy);

    //declare a gloval variable here to obtain the original json data
    var data = [];
    //Obtain data from the placeholder
    function fetchDataFromAPI()
    {
      document.getElementById("sortTitle").style.display ="inline";
      document.getElementById("groupBy").style.display ="inline";
      //document.getElementById("groupBy").style.display="inline"
      fetch('https://jsonplaceholder.typicode.com/posts')
      .then(response => response.json()) //call json() method to transform the Response object into an object that can be interacted with
      //.then(json =>console.log(json.length))
      //Extract to HTML table
      .then(json => {

        data = json;

        //create dyananmic <table>
        var table = document.createElement("table");
        table.setAttribute('border', '1');
        table.setAttribute('cellspacing', '0');
        table.setAttribute('cellpadding', '5');

        //retrieve column header
        var column = []; //define an empty array
        for (var i = 0; i <json.length; i++)
        {
            for (var key in json[i]) //looping through properties of object
            {
              if(column.indexOf(key) === -1)
              {
                column.push(key);
              }
            }
        }
        //create html table header row using the extracted headers
         var tr = table.insertRow(-1); //table insertRow
         //console.log("this is tr : ", tr)

         for (var i = 0; i < column.length; i++)
         {
           var th = document.createElement("th");
           th.innerHTML = column[i]; //change the value inside th
           tr.appendChild(th); //add
         }

         //add the json data to the tabel as rows
         for (var i = 0; i <json.length; i++)
         {
           tr = table.insertRow(-1);

           for (var j = 0; j <column.length; j++)
           {
             var tabCell = tr.insertCell(-1);
             tabCell.innerHTML = json[i][column[j]];
           }
         }

         //add newly created table with json data to a container
         var divContainer = document.getElementById("showData");
         divContainer.innerHTML="";
         divContainer.appendChild(table);
          }
        ) //end of extraction to HTML table
    } //end of fetch data api

    function sortTitle ()
    {
      //declare a local variable for data (so the orignal data remains untouched)
      var localData = [];
      localData = data;

      //proceed to sort using the function of javascript
      localData.sort(function(a,b)
      {
          if(a.title < b.title)
          {
            return -1;
          }

          if(a.title > b.title)
          {
            return 1;
          }
          return 0;
      })
      console.log(localData);

      //create dyananmic <table>
      var table = document.createElement("table");
      table.setAttribute('border', '1');
      table.setAttribute('cellspacing', '0');
      table.setAttribute('cellpadding', '5');

      //retrieve column header
      var column = []; //define an empty array
      for (var i = 0; i <localData.length; i++)
      {
          for (var key in localData[i]) //looping through properties of object
          {
            if(column.indexOf(key) === -1)
            {
              column.push(key);
            }
          }
      }
      //create html table header row using the extracted headers
       var tr = table.insertRow(-1); //table insertRow
       //console.log("this is tr : ", tr)

       for (var i = 0; i < column.length; i++)
       {
         var th = document.createElement("th");
         th.innerHTML = column[i]; //change the value inside th
         tr.appendChild(th); //add
       }

       //add the json data to the tabel as rows
       for (var i = 0; i <localData.length; i++)
       {
         tr = table.insertRow(-1);

         for (var j = 0; j <column.length; j++)
         {
           var tabCell = tr.insertCell(-1);
           tabCell.innerHTML = localData[i][column[j]];
         }
       }

       //add newly created table with json data to a container
       var divContainer = document.getElementById("showData");
       divContainer.innerHTML="";
       divContainer.appendChild(table);



    } //end of sortTitle function

    function groupBy()
    {
      //declare a local variable for data (so the orignal data remains untouched)
      var localData = [];
      localData = data;

      var groupData = _.groupBy(localData, "userId");
      console.log(groupData);

      

      }


    </script>
  </body>

</html>
